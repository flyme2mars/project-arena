<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Donut</title>
    <style>
      canvas {
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="800" height="600"></canvas>

    <script>
      var canvas = document.getElementById('canvas')
      var ctx = canvas.getContext('2d')

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)

        var A = 0 // rotating around Y axis
        var B = 0 // rotating around Z axis
        var R1 = 1 // radius of torus
        var R2 = 2 // radius from center of torus to center of tube
        var K1 = 100 // screen scaling factor
        var K2 = 5 // 3D scaling factor

        for (var i = 0; i < 6.28; i += 0.1) {
          // i for theta
          for (var j = 0; j < 6.28; j += 0.05) {
            // j for phi
            var c = Math.cos(i)
            var s = Math.sin(i)
            var c2 = Math.cos(j)
            var s2 = Math.sin(j)

            // 3D coordinates
            var x = (R2 + R1 * c2) * c
            var y = (R2 + R1 * c2) * s
            var z = R1 * s2

            // Rotation around Y and Z axes
            var x0 = x
            var y0 = c * y + s * z
            var z0 = -s * y + c * z

            // Project 3D to 2D
            var ooz = 1 / (z0 + K2) // one over z
            var xp = (canvas.width / 2 + K1 * ooz * x0) | 0
            var yp = (canvas.height / 2 - K1 * ooz * y0) | 0

            // Calculate 'luminosity' for coloring
            var L = 0.7 * (c2 * c + s * Math.cos(A) * s2 + Math.cos(B) * c * Math.sin(A) * s2 + Math.sin(B) * s * s2)

            // Choose color based on luminosity
            if (L > 0) {
              ctx.fillStyle = `hsl(${L * 120},100%,50%)`
              ctx.beginPath()
              ctx.arc(xp, yp, 1, 0, Math.PI * 2)
              ctx.fill()
            }
          }
        }

        // Update rotation angles
        A += 0.05
        B += 0.03

        requestAnimationFrame(draw)
      }

      draw()
    </script>
  </body>
</html>
